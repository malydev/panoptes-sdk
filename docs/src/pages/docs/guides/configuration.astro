---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '../../../components/ui/card';
import { CodeBlock, InlineCode } from '../../../components/ui/code-block';
import { Badge } from '../../../components/ui/badge';
import { Separator } from '../../../components/ui/separator';
---

<DocsLayout title="Configuration - Panoptes SDK" description="Complete configuration guide for Panoptes SDK">
  <div class="space-y-10">
    <div class="mb-8">
      <h1 class="text-4xl font-bold tracking-tight mb-4">
        <span class="lang-en">Configuration Guide</span>
        <span class="lang-es">Guía de Configuración</span>
      </h1>
      <p class="text-xl text-slate-600 dark:text-slate-400">
        <span class="lang-en">Learn how to configure Panoptes SDK to fit your application's needs. From basic setup to advanced options.</span>
        <span class="lang-es">Aprende cómo configurar Panoptes SDK para adaptarse a las necesidades de tu aplicación. Desde configuración básica hasta opciones avanzadas.</span>
      </p>
    </div>

    <!-- initAudit Configuration -->
    <div class="space-y-6">
      <h2 class="text-2xl font-bold">
        <span class="lang-en">Core Configuration: </span>
        <span class="lang-es">Configuración Principal: </span>
        <InlineCode client:load>initAudit()</InlineCode>
      </h2>

      <p class="text-slate-600 dark:text-slate-400">
        <span class="lang-en">The <InlineCode client:load>initAudit()</InlineCode> function initializes the Panoptes SDK and must be called once at application startup. It configures how audit events are captured and where they're sent.</span>
        <span class="lang-es">La función <InlineCode client:load>initAudit()</InlineCode> inicializa el SDK de Panoptes y debe ser llamada una vez al inicio de la aplicación. Configura cómo se capturan los eventos de auditoría y dónde se envían.</span>
      </p>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Basic Configuration</span>
            <span class="lang-es">Configuración Básica</span>
          </CardTitle>
          <CardDescription>
            <span class="lang-en">Minimum required configuration to get started</span>
            <span class="lang-es">Configuración mínima requerida para comenzar</span>
          </CardDescription>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`import { initAudit } from '@panoptes/sdk';

initAudit({
  appName: 'my-app',           // Required: Your application name
  environment: 'production',   // Optional: development, staging, production
  transports: {
    enabled: ['console']       // At least one transport required
  }
});`}
          />
        </CardContent>
      </Card>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Complete Configuration</span>
            <span class="lang-es">Configuración Completa</span>
          </CardTitle>
          <CardDescription>
            <span class="lang-en">All available options with descriptions</span>
            <span class="lang-es">Todas las opciones disponibles con descripciones</span>
          </CardDescription>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`import { initAudit } from '@panoptes/sdk';

initAudit({
  // Application metadata
  appName: 'my-app',              // Required: Identifies your application in logs
  environment: 'production',      // Optional: 'development' | 'staging' | 'production'
  version: '1.0.0',              // Optional: Your app version

  // Audit behavior
  enabled: true,                  // Optional: Master switch (default: true)
  captureBeforeState: true,      // Optional: Capture data before UPDATE/DELETE (default: true)
  captureAfterState: true,       // Optional: Capture data after INSERT/UPDATE (default: true)

  // Performance options
  asyncMode: true,               // Optional: Process audits asynchronously (default: true)
  bufferSize: 100,              // Optional: Buffer size for async mode (default: 100)

  // Transports configuration
  transports: {
    enabled: ['console', 'database', 'file', 'http'],

    // Console transport options
    console: {
      prettyPrint: true          // Optional: Pretty print JSON (default: false)
    },

    // File transport options
    file: {
      path: './logs/audit.log'   // Optional: Log file path (default: 'panoptes-audit.log')
    },

    // HTTP transport options
    http: {
      endpoint: 'https://api.example.com/audit',  // Required for HTTP transport
      headers: {                                   // Optional: Custom headers
        'Authorization': 'Bearer token',
        'X-Custom-Header': 'value'
      },
      timeout: 5000                               // Optional: Request timeout in ms (default: 5000)
    },

    // Database transport options
    database: {
      client: auditDbClient,      // Required: Database client instance
      engine: 'postgres',         // Required: 'postgres' | 'mysql' | 'mssql' | 'sqlite' | 'oracle'
      tableName: 'audit_logs',    // Optional: Table name (default: 'panoptes_audit_log')
      autoCreateTable: true       // Optional: Auto-create audit table (default: false)
    }
  },

  // Filtering rules (optional)
  rules: {
    // Tables to always audit (all operations)
    includeTables: ['users', 'orders', 'payments'],

    // Tables to never audit
    excludeTables: ['sessions', 'logs', 'cache'],

    // Operations to audit (if not specified, all are audited)
    includeOperations: ['INSERT', 'UPDATE', 'DELETE'],

    // Custom filter function
    filter: (auditEvent) => {
      // Return true to audit, false to skip
      return auditEvent.operation.type !== 'SELECT';
    }
  },

  // Error handling (optional)
  onError: (error, auditEvent) => {
    console.error('Audit error:', error);
    // You can send to error tracking service here
  }
});`}
          />
        </CardContent>
      </Card>
    </div>

    <Separator client:load className="my-8" />

    <!-- Configuration by Environment -->
    <div class="space-y-6">
      <h2 class="text-2xl font-bold">
        <span class="lang-en">Configuration by Environment</span>
        <span class="lang-es">Configuración por Ambiente</span>
      </h2>

      <p class="text-slate-600 dark:text-slate-400">
        <span class="lang-en">Different environments typically require different configurations. Here are recommended setups for each environment.</span>
        <span class="lang-es">Diferentes ambientes típicamente requieren diferentes configuraciones. Aquí están las configuraciones recomendadas para cada ambiente.</span>
      </p>

      <!-- Development -->
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <Badge client:load variant="secondary">Development</Badge>
          <h3 class="text-lg font-semibold">
            <span class="lang-en">Development Environment</span>
            <span class="lang-es">Ambiente de Desarrollo</span>
          </h3>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-400">
          <span class="lang-en">Console output with pretty printing for easy debugging</span>
          <span class="lang-es">Salida de consola con formato para fácil depuración</span>
        </p>
        <CodeBlock
          client:load
          language="javascript"
          code={`initAudit({
  appName: 'my-app',
  environment: 'development',
  transports: {
    enabled: ['console'],
    console: {
      prettyPrint: true
    }
  },
  captureBeforeState: true,
  captureAfterState: true
});`}
        />
      </div>

      <Separator client:load className="my-6" />

      <!-- Staging -->
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <Badge client:load variant="secondary">Staging</Badge>
          <h3 class="text-lg font-semibold">
            <span class="lang-en">Staging Environment</span>
            <span class="lang-es">Ambiente de Staging</span>
          </h3>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-400">
          <span class="lang-en">Console + file logging for testing before production</span>
          <span class="lang-es">Consola + archivo para probar antes de producción</span>
        </p>
        <CodeBlock
          client:load
          language="javascript"
          code={`initAudit({
  appName: 'my-app',
  environment: 'staging',
  transports: {
    enabled: ['console', 'file'],
    file: {
      path: '/var/log/audit.log'
    }
  },
  asyncMode: true,
  bufferSize: 100
});`}
        />
      </div>

      <Separator client:load className="my-6" />

      <!-- Production -->
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <Badge client:load variant="default">Production</Badge>
          <h3 class="text-lg font-semibold">
            <span class="lang-en">Production Environment</span>
            <span class="lang-es">Ambiente de Producción</span>
          </h3>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-400">
          <span class="lang-en">Database + SIEM integration for compliance</span>
          <span class="lang-es">Base de datos + integración SIEM para cumplimiento</span>
        </p>
        <CodeBlock
          client:load
          language="javascript"
          code={`initAudit({
  appName: 'my-app',
  environment: 'production',
  transports: {
    enabled: ['database', 'http'],
    database: {
      client: auditDb,
      engine: 'postgres',
      autoCreateTable: true
    },
    http: {
      endpoint: process.env.SIEM_URL,
      headers: {
        'Authorization': \`Bearer \${process.env.SIEM_TOKEN}\`
      }
    }
  },
  asyncMode: true,
  bufferSize: 500,
  onError: (error) => {
    errorTracker.capture(error);
  }
});`}
        />
      </div>
    </div>

    <Separator client:load className="my-8" />

    <!-- User Context Configuration -->
    <div class="space-y-6">
      <h2 class="text-2xl font-bold">
        <span class="lang-en">User Context: </span>
        <span class="lang-es">Contexto de Usuario: </span>
        <InlineCode client:load>setUserContext()</InlineCode>
      </h2>

      <p class="text-slate-600 dark:text-slate-400">
        <span class="lang-en">User context provides crucial information about who is performing database operations. This should be set for each request or session.</span>
        <span class="lang-es">El contexto de usuario proporciona información crucial sobre quién está realizando operaciones en la base de datos. Esto debe establecerse para cada petición o sesión.</span>
      </p>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Complete User Context</span>
            <span class="lang-es">Contexto de Usuario Completo</span>
          </CardTitle>
          <CardDescription>
            <span class="lang-en">All available user context fields</span>
            <span class="lang-es">Todos los campos de contexto de usuario disponibles</span>
          </CardDescription>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`import { setUserContext } from '@panoptes/sdk';

setUserContext({
  // Actor information (who is making the change)
  actorType: 'USER',              // 'USER' | 'SERVICE' | 'SYSTEM' | 'ADMIN' | 'API'
  actorId: 'user-123',            // Unique user/service identifier
  actorName: 'John Doe',          // Display name
  actorEmail: 'john@example.com', // Email address (optional)
  actorRoles: ['admin', 'editor'], // User roles (optional)

  // Tenant/Organization (for multi-tenant apps)
  tenantId: 'org-456',            // Organization/tenant identifier (optional)
  tenantName: 'Acme Corp',        // Organization name (optional)

  // Request context
  requestId: 'req-789',           // Request/correlation ID (optional)
  sessionId: 'sess-abc',          // Session identifier (optional)
  actorIp: '192.168.1.100',       // IP address (optional)
  userAgent: 'Mozilla/5.0...',    // Browser/client info (optional)

  // Custom metadata
  metadata: {                     // Any additional custom fields
    department: 'Engineering',
    location: 'US-WEST',
    authMethod: 'SSO'
  }
});`}
          />
        </CardContent>
      </Card>

      <Card className="border-indigo-500/20 dark:border-violet-400/20 bg-indigo-500/5 dark:bg-violet-400/5">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-lg">
            <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="lang-en">Integration with Web Frameworks</span>
            <span class="lang-es">Integración con Frameworks Web</span>
          </CardTitle>
        </CardHeader>
        <CardContent class="space-y-4">
          <div>
            <h4 class="font-semibold mb-2">Express.js</h4>
            <CodeBlock
              client:load
              language="javascript"
              code={`// Middleware to set user context from request
app.use((req, res, next) => {
  if (req.user) {
    setUserContext({
      actorType: 'USER',
      actorId: req.user.id,
      actorName: req.user.name,
      actorEmail: req.user.email,
      actorRoles: req.user.roles,
      requestId: req.id,
      sessionId: req.session?.id,
      actorIp: req.ip,
      userAgent: req.get('user-agent')
    });
  }
  next();
});`}
            />
          </div>

          <Separator client:load />

          <div>
            <h4 class="font-semibold mb-2">Next.js (App Router)</h4>
            <CodeBlock
              client:load
              language="javascript"
              code={`// In middleware.ts or before database operations
import { setUserContext } from '@panoptes/sdk';
import { auth } from '@/auth';

export async function middleware(request) {
  const session = await auth();

  if (session?.user) {
    setUserContext({
      actorType: 'USER',
      actorId: session.user.id,
      actorName: session.user.name,
      actorEmail: session.user.email,
      requestId: request.headers.get('x-request-id'),
      actorIp: request.ip
    });
  }
}`}
            />
          </div>

          <Separator client:load />

          <div>
            <h4 class="font-semibold mb-2">Fastify</h4>
            <CodeBlock
              client:load
              language="javascript"
              code={`// Fastify hook
fastify.addHook('onRequest', async (request, reply) => {
  if (request.user) {
    setUserContext({
      actorType: 'USER',
      actorId: request.user.id,
      actorName: request.user.name,
      actorEmail: request.user.email,
      requestId: request.id,
      actorIp: request.ip,
      userAgent: request.headers['user-agent']
    });
  }
});`}
            />
          </div>
        </CardContent>
      </Card>
    </div>

    <Separator client:load className="my-8" />

    <!-- Audit Rules Configuration -->
    <div class="space-y-6">
      <h2 class="text-2xl font-bold">
        <span class="lang-en">Audit Rules & Filtering</span>
        <span class="lang-es">Reglas de Auditoría y Filtrado</span>
      </h2>

      <p class="text-slate-600 dark:text-slate-400">
        <span class="lang-en">Configure which tables and operations to audit. By default, Panoptes audits all operations on all tables.</span>
        <span class="lang-es">Configura qué tablas y operaciones auditar. Por defecto, Panoptes audita todas las operaciones en todas las tablas.</span>
      </p>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Table-based Filtering</span>
            <span class="lang-es">Filtrado Basado en Tablas</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`initAudit({
  appName: 'my-app',
  transports: { enabled: ['database'] },
  rules: {
    // Option 1: Whitelist approach - only audit these tables
    includeTables: ['users', 'orders', 'payments', 'customers'],

    // Option 2: Blacklist approach - audit all EXCEPT these tables
    excludeTables: ['sessions', 'cache', 'logs', 'migrations'],

    // Note: Use either includeTables OR excludeTables, not both
  }
});`}
          />
        </CardContent>
      </Card>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Operation-based Filtering</span>
            <span class="lang-es">Filtrado Basado en Operaciones</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`initAudit({
  appName: 'my-app',
  transports: { enabled: ['database'] },
  rules: {
    // Only audit data modifications (skip SELECT)
    includeOperations: ['INSERT', 'UPDATE', 'DELETE'],

    // Or exclude specific operations
    excludeOperations: ['SELECT'],
  }
});`}
          />
        </CardContent>
      </Card>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Custom Filter Function</span>
            <span class="lang-es">Función de Filtrado Personalizada</span>
          </CardTitle>
          <CardDescription>
            <span class="lang-en">Advanced filtering with custom logic</span>
            <span class="lang-es">Filtrado avanzado con lógica personalizada</span>
          </CardDescription>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`initAudit({
  appName: 'my-app',
  transports: { enabled: ['database'] },
  rules: {
    filter: (auditEvent) => {
      // Skip if no user context (system operations)
      if (!auditEvent.actor?.userId) {
        return false;
      }

      // Only audit sensitive tables
      const sensitiveTables = ['users', 'payments', 'personal_data'];
      if (!sensitiveTables.includes(auditEvent.operation.mainTable)) {
        return false;
      }

      // Skip SELECT operations on non-sensitive data
      if (auditEvent.operation.type === 'SELECT' &&
          !auditEvent.operation.mainTable.includes('sensitive')) {
        return false;
      }

      // Only audit operations by non-admin users
      if (auditEvent.actor.roles?.includes('super-admin')) {
        return false; // Don't audit super-admin actions
      }

      return true; // Audit this event
    }
  }
});`}
          />
        </CardContent>
      </Card>

      <Card className="border-indigo-500/20 dark:border-violet-400/20 bg-indigo-500/5 dark:bg-violet-400/5">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-lg">
            <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
            <span class="lang-en">Best Practices for Filtering</span>
            <span class="lang-es">Mejores Prácticas para Filtrado</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <ul class="space-y-2 text-sm">
            <li class="flex items-start gap-2">
              <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="lang-en"><strong>Start broad, then narrow:</strong> Begin by auditing everything, then exclude as needed</span>
              <span class="lang-es"><strong>Empieza amplio, luego reduce:</strong> Comienza auditando todo, luego excluye según necesites</span>
            </li>
            <li class="flex items-start gap-2">
              <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="lang-en"><strong>Skip high-volume tables:</strong> Exclude logs, sessions, and cache tables</span>
              <span class="lang-es"><strong>Omite tablas de alto volumen:</strong> Excluye logs, sesiones y tablas de caché</span>
            </li>
            <li class="flex items-start gap-2">
              <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="lang-en"><strong>Focus on sensitive data:</strong> Always audit PII, financial, and authentication tables</span>
              <span class="lang-es"><strong>Enfócate en datos sensibles:</strong> Siempre audita PII, financieros y tablas de autenticación</span>
            </li>
            <li class="flex items-start gap-2">
              <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="lang-en"><strong>Consider performance:</strong> Filtering reduces storage and processing costs</span>
              <span class="lang-es"><strong>Considera el rendimiento:</strong> El filtrado reduce costos de almacenamiento y procesamiento</span>
            </li>
          </ul>
        </CardContent>
      </Card>
    </div>

    <Separator client:load className="my-8" />

    <!-- Environment Variables -->
    <div class="space-y-6">
      <h2 class="text-2xl font-bold">
        <span class="lang-en">Environment Variables</span>
        <span class="lang-es">Variables de Entorno</span>
      </h2>

      <p class="text-slate-600 dark:text-slate-400">
        <span class="lang-en">For security and flexibility, use environment variables for sensitive configuration values.</span>
        <span class="lang-es">Por seguridad y flexibilidad, usa variables de entorno para valores de configuración sensibles.</span>
      </p>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Recommended .env Configuration</span>
            <span class="lang-es">Configuración .env Recomendada</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="bash"
            code={`# Application
PANOPTES_APP_NAME=my-app
PANOPTES_ENVIRONMENT=production
PANOPTES_VERSION=1.0.0

# Audit behavior
PANOPTES_ENABLED=true
PANOPTES_ASYNC_MODE=true
PANOPTES_BUFFER_SIZE=500

# Transports
PANOPTES_TRANSPORTS=database,http
PANOPTES_FILE_PATH=/var/log/panoptes/audit.log

# HTTP Transport
PANOPTES_HTTP_ENDPOINT=https://siem.example.com/api/events
PANOPTES_HTTP_TOKEN=your-secret-token

# Database Transport (Audit Database)
PANOPTES_AUDIT_DB_HOST=audit-db.example.com
PANOPTES_AUDIT_DB_PORT=5432
PANOPTES_AUDIT_DB_NAME=audit_logs
PANOPTES_AUDIT_DB_USER=audit_user
PANOPTES_AUDIT_DB_PASSWORD=secure-password
PANOPTES_AUDIT_TABLE_NAME=panoptes_audit_log
PANOPTES_AUTO_CREATE_TABLE=true`}
          />
        </CardContent>
      </Card>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Using Environment Variables in Code</span>
            <span class="lang-es">Usando Variables de Entorno en Código</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`import { initAudit, createAuditedPostgresClient } from '@panoptes/sdk';
import { Client } from 'pg';

// Create audit database client
const auditDbClient = new Client({
  host: process.env.PANOPTES_AUDIT_DB_HOST,
  port: parseInt(process.env.PANOPTES_AUDIT_DB_PORT || '5432'),
  database: process.env.PANOPTES_AUDIT_DB_NAME,
  user: process.env.PANOPTES_AUDIT_DB_USER,
  password: process.env.PANOPTES_AUDIT_DB_PASSWORD
});

await auditDbClient.connect();

// Initialize with environment variables
initAudit({
  appName: process.env.PANOPTES_APP_NAME || 'my-app',
  environment: process.env.PANOPTES_ENVIRONMENT || 'development',
  version: process.env.PANOPTES_VERSION,
  enabled: process.env.PANOPTES_ENABLED !== 'false',
  asyncMode: process.env.PANOPTES_ASYNC_MODE === 'true',
  bufferSize: parseInt(process.env.PANOPTES_BUFFER_SIZE || '100'),
  transports: {
    enabled: process.env.PANOPTES_TRANSPORTS?.split(',') || ['console'],
    file: {
      path: process.env.PANOPTES_FILE_PATH
    },
    http: {
      endpoint: process.env.PANOPTES_HTTP_ENDPOINT,
      headers: {
        'Authorization': \`Bearer \${process.env.PANOPTES_HTTP_TOKEN}\`
      }
    },
    database: {
      client: auditDbClient,
      engine: 'postgres',
      tableName: process.env.PANOPTES_AUDIT_TABLE_NAME || 'panoptes_audit_log',
      autoCreateTable: process.env.PANOPTES_AUTO_CREATE_TABLE === 'true'
    }
  }
});`}
          />
        </CardContent>
      </Card>
    </div>

    <Separator client:load className="my-8" />

    <!-- Performance Configuration -->
    <div class="space-y-6">
      <h2 class="text-2xl font-bold">
        <span class="lang-en">Performance Optimization</span>
        <span class="lang-es">Optimización de Rendimiento</span>
      </h2>

      <Card className="border-slate-200/60 dark:border-slate-700/50 bg-white dark:bg-gray-900/90">
        <CardHeader>
          <CardTitle className="text-lg">
            <span class="lang-en">Async Mode & Buffering</span>
            <span class="lang-es">Modo Async y Buffering</span>
          </CardTitle>
          <CardDescription>
            <span class="lang-en">Recommended for high-throughput applications</span>
            <span class="lang-es">Recomendado para aplicaciones de alto rendimiento</span>
          </CardDescription>
        </CardHeader>
        <CardContent>
          <CodeBlock
            client:load
            language="javascript"
            code={`initAudit({
  appName: 'my-app',

  // Enable async processing (non-blocking)
  asyncMode: true,          // Default: true

  // Buffer size - higher = better batching, but more memory
  bufferSize: 500,         // Default: 100

  // For high-volume scenarios
  captureBeforeState: false, // Skip before state if not needed

  transports: {
    enabled: ['database'],
    database: {
      // Use connection pooling for audit DB
      client: auditPoolClient,
      engine: 'postgres'
    }
  }
});`}
          />
          <div class="mt-4 space-y-2 text-sm text-slate-600 dark:text-slate-400">
            <p><strong class="text-slate-900 dark:text-slate-200">
              <span class="lang-en">asyncMode:</span>
              <span class="lang-es">asyncMode:</span>
            </strong> <span class="lang-en">Processes audits in background, doesn't block your queries</span><span class="lang-es">Procesa auditorías en segundo plano, no bloquea tus consultas</span></p>
            <p><strong class="text-slate-900 dark:text-slate-200">
              <span class="lang-en">bufferSize:</span>
              <span class="lang-es">bufferSize:</span>
            </strong> <span class="lang-en">Number of events to buffer before processing (higher = better performance)</span><span class="lang-es">Número de eventos a bufferear antes de procesar (mayor = mejor rendimiento)</span></p>
          </div>
        </CardContent>
      </Card>

      <Card className="border-indigo-500/20 dark:border-violet-400/20 bg-indigo-500/5 dark:bg-violet-400/5">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-lg">
            <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            <span class="lang-en">Performance Tips</span>
            <span class="lang-es">Consejos de Rendimiento</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <ul class="space-y-2 text-sm">
            <li class="flex items-start gap-2">
              <span class="text-indigo-500 dark:text-violet-400 font-bold">1.</span>
              <span class="lang-en"><strong>Use async mode</strong> in production (default: true)</span>
              <span class="lang-es"><strong>Usa modo async</strong> en producción (default: true)</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-indigo-500 dark:text-violet-400 font-bold">2.</span>
              <span class="lang-en"><strong>Increase buffer size</strong> for high-volume apps (500-1000)</span>
              <span class="lang-es"><strong>Aumenta el buffer</strong> para apps de alto volumen (500-1000)</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-indigo-500 dark:text-violet-400 font-bold">3.</span>
              <span class="lang-en"><strong>Skip before state</strong> if you don't need it (saves DB reads)</span>
              <span class="lang-es"><strong>Omite estado anterior</strong> si no lo necesitas (ahorra lecturas BD)</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-indigo-500 dark:text-violet-400 font-bold">4.</span>
              <span class="lang-en"><strong>Filter aggressively</strong> - only audit what you need</span>
              <span class="lang-es"><strong>Filtra agresivamente</strong> - solo audita lo necesario</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-indigo-500 dark:text-violet-400 font-bold">5.</span>
              <span class="lang-en"><strong>Use separate audit DB</strong> - don't store audits in your app database</span>
              <span class="lang-es"><strong>Usa BD de auditoría separada</strong> - no almacenes auditorías en tu BD de app</span>
            </li>
          </ul>
        </CardContent>
      </Card>
    </div>

    <Separator client:load className="my-8" />

    <!-- Next Steps -->
    <div class="mb-10">
      <h2 class="text-3xl font-bold mb-4">
        <span class="lang-en">Next Steps</span>
        <span class="lang-es">Próximos Pasos</span>
      </h2>
      <p class="text-lg text-slate-600 dark:text-slate-400 mb-6">
        <span class="lang-en">Now that you know how to configure Panoptes, continue to Integrations to learn about transports and external systems.</span>
        <span class="lang-es">Ahora que sabes cómo configurar Panoptes, continúa a Integraciones para aprender sobre transportes y sistemas externos.</span>
      </p>

      <a href="/docs/integrations" class="block">
        <Card client:load className="border-slate-200/60 dark:border-slate-700/50 hover:border-indigo-500 dark:hover:border-violet-400 transition-colors cursor-pointer">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <svg class="h-5 w-5 text-indigo-500 dark:text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
              </svg>
              <span class="lang-en">Continue to Integrations</span>
              <span class="lang-es">Continuar a Integraciones</span>
            </CardTitle>
            <CardDescription>
              <span class="lang-en">Learn about all available transports and integrations</span>
              <span class="lang-es">Aprende sobre todos los transportes e integraciones disponibles</span>
            </CardDescription>
          </CardHeader>
        </Card>
      </a>
    </div>
  </div>
</DocsLayout>
